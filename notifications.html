<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <title>Ghasiq - الإشعارات الداخلية</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet" />
    <style>
        :root {
            --primary: #2563eb;
            --primary-light: #3b82f6;
            --accent: #22c55e;

            --bg-main: #020617;
            --bg-elevated: rgba(15, 23, 42, 0.94);
            --bg-card: rgba(15, 23, 42, 0.98);
            --border-subtle: rgba(148, 163, 184, 0.35);

            --text-main: #e5e7eb;
            --text-muted: #9ca3af;
            --shadow-strong: 0 20px 45px rgba(0, 0, 0, 0.8);
        }

        body.light {
            --bg-main: #f5f7fb;
            --bg-elevated: #ffffff;
            --bg-card: #ffffff;
            --border-subtle: rgba(148, 163, 184, 0.5);
            --text-main: #0f172a;
            --text-muted: #6b7280;
            --shadow-strong: 0 20px 45px rgba(15, 23, 42, 0.15);
        }

        * { margin:0; padding:0; box-sizing:border-box; }

        body {
            font-family:"Cairo",system-ui;
            background:
                radial-gradient(circle at top left, rgba(37, 99, 235, 0.35), transparent 55%),
                radial-gradient(circle at bottom right, rgba(56, 189, 248, 0.28), transparent 55%),
                linear-gradient(135deg, #00020b, var(--bg-main) 45%, #00010a);
            color:var(--text-main);
            min-height:100vh;
        }

        body.light {
            background:
                radial-gradient(circle at top left, rgba(191, 219, 254, 0.7), transparent 55%),
                radial-gradient(circle at bottom right, rgba(219, 234, 254, 0.7), transparent 55%),
                linear-gradient(135deg, #e5edff, #f9fafb 50%, #eff6ff);
        }

        a { text-decoration:none; color:inherit; }

        .page {
            max-width:1140px;
            margin:0 auto;
            padding:20px 18px 40px;
        }

        /* NAVBAR */
        .navbar {
            display:flex;
            align-items:center;
            justify-content:space-between;
            padding:14px 18px;
            border-radius:16px;
            background:var(--bg-elevated);
            box-shadow:
                0 16px 35px rgba(0,0,0,0.75),
                0 0 0 1px rgba(148,163,184,0.3);
            margin-bottom:26px;
            backdrop-filter:blur(14px);
        }

        .navbar-left {
            display:flex;
            align-items:center;
            gap:14px;
        }

        .logo {
            height:46px;
            cursor:pointer;
        }

        .nav-links {
            display:flex;
            gap:16px;
            font-size:14px;
            color:var(--text-muted);
        }

        .nav-links a {
            position:relative;
            padding-bottom:4px;
        }

        .nav-links a::after {
            content:"";
            position:absolute;
            right:0;
            bottom:0;
            width:0;
            height:2px;
            border-radius:999px;
            background:linear-gradient(90deg,var(--primary-light),var(--primary));
            transition:width .18s ease;
        }

        .nav-links a:hover::after {
            width:100%;
        }

        .nav-links a.active {
            color:#e5e7eb;
            font-weight:600;
        }

        .nav-links a.active::after {
            width:100%;
        }

        .nav-actions {
            display:flex;
            align-items:center;
            gap:8px;
        }

        .btn-toggle-theme,
        .btn-logout {
            border-radius:999px;
            padding:6px 12px;
            font-size:12px;
            cursor:pointer;
            border:1px solid var(--border-subtle);
            background:rgba(15,23,42,0.85);
            color:#e5e7eb;
        }

        body.light .btn-toggle-theme,
        body.light .btn-logout {
            background:#ffffff;
            color:#0f172a;
        }

        .btn-logout {
            border-color:#f97373;
            color:#fecaca;
        }

        body.light .btn-logout {
            color:#b91c1c;
        }

        .user-chip {
            font-size:11px;
            padding:4px 10px;
            border-radius:999px;
            border:1px solid rgba(148,163,184,0.7);
            color:var(--text-muted);
        }

        /* LAYOUT */
        .notifications-layout {
            display:grid;
            grid-template-columns:minmax(0,1.1fr) minmax(0,1fr);
            gap:20px;
        }

        @media(max-width:900px){
            .notifications-layout {
                grid-template-columns:1fr;
            }
        }

        .card {
            border-radius:22px;
            background:var(--bg-elevated);
            border:1px solid var(--border-subtle);
            box-shadow:var(--shadow-strong);
            padding:18px 18px 20px;
        }

        .card-header-title {
            font-size:18px;
            margin-bottom:4px;
        }

        .card-header-sub {
            font-size:13px;
            color:var(--text-muted);
            margin-bottom:10px;
        }

        .notif-list {
            margin-top:10px;
            border-radius:16px;
            background:var(--bg-card);
            border:1px solid rgba(148,163,184,0.35);
            padding:10px 12px;
            max-height:420px;
            overflow-y:auto;
        }

        .notif-item {
            padding:8px 8px;
            border-radius:10px;
            border:1px solid rgba(148,163,184,0.3);
            margin-bottom:8px;
            font-size:13px;
        }

        .notif-item:last-child { margin-bottom:0; }

        .notif-meta {
            display:flex;
            justify-content:space-between;
            align-items:center;
            font-size:11px;
            color:var(--text-muted);
            margin-top:4px;
        }

        .notif-empty {
            font-size:13px;
            color:var(--text-muted);
            padding:10px 2px;
            text-align:center;
        }

        /* employees list */
        .employees-list {
            margin-top:10px;
            border-radius:16px;
            background:var(--bg-card);
            border:1px solid rgba(148,163,184,0.35);
            padding:10px 12px;
            max-height:420px;
            overflow-y:auto;
        }

        .employee-item {
            display:flex;
            justify-content:space-between;
            align-items:center;
            padding:8px 6px;
            border-radius:10px;
            border:1px solid rgba(148,163,184,0.3);
            margin-bottom:8px;
            font-size:13px;
        }

        .employee-main {
            display:flex;
            flex-direction:column;
            gap:2px;
        }

        .employee-name {
            font-size:13px;
        }

        .employee-title {
            font-size:11px;
            color:var(--text-muted);
        }

        .employee-dept {
            font-size:11px;
            color:var(--primary-light);
        }

        .btn-send {
            border-radius:999px;
            padding:6px 12px;
            font-size:12px;
            cursor:pointer;
            border:none;
            background:radial-gradient(circle at top left,rgba(59,130,246,0.6),rgba(37,99,235,1));
            color:#e5e7eb;
            box-shadow:0 0 20px rgba(59,130,246,0.6);
        }

        .btn-clear {
            margin-top:8px;
            border-radius:999px;
            padding:6px 12px;
            font-size:12px;
            cursor:pointer;
            border:1px solid rgba(248,113,113,0.7);
            background:transparent;
            color:#fecaca;
        }

        body.light .btn-clear {
            color:#b91c1c;
            border-color:#fecaca;
        }

        .footer {
            margin-top:26px;
            text-align:center;
            font-size:12px;
            color:var(--text-muted);
        }

        .footer span {
            color:var(--primary-light);
        }
    </style>
</head>
<body class="dark">

<!-- حماية الصفحة -->
<script>
    (function guard() {
        const user = JSON.parse(localStorage.getItem("ghasiq_user") || "null");
        if (!user || !user.login) {
            window.location.href = "login.html";
        }
        window.__gh_user = user;
    })();
</script>

<div class="page">

    <!-- NAVBAR -->
    <header class="navbar">
        <div class="navbar-left">
            <a href="index.html">
                <img src="logo.png" alt="GHASIQ Logo" class="logo" />
            </a>

            <nav class="nav-links">
                <a href="index.html#about">عن Ghasiq</a>
                <a href="services.html">الخدمات</a>
                <a href="call-system.html">نظام الاتصال</a>
                <a href="notifications.html" class="active">الإشعارات</a>
            </nav>
        </div>

        <div class="nav-actions">
            <span id="userChip" class="user-chip">User</span>

            <button class="btn-toggle-theme" id="themeToggle" type="button">
                <span id="themeLabel">Dark</span>
            </button>

            <button class="btn-logout" type="button" onclick="logout()">تسجيل الخروج</button>
        </div>
    </header>

    <!-- MAIN LAYOUT -->
    <section class="notifications-layout">
        <!-- سجل الإشعارات -->
        <div class="card">
            <div class="card-header-title">سجل الإشعارات</div>
            <div class="card-header-sub">
                هذه هي الإشعارات التي تم إرسالها إليك من خلال النظام. تظهر هنا فقط الإشعارات الخاصة بالمستخدم الحالي.
            </div>

            <div id="notifList" class="notif-list">
                <div class="notif-empty">لا توجد إشعارات حتى الآن.</div>
            </div>

            <button id="btnClearMyNotifs" class="btn-clear">مسح إشعاراتي</button>
        </div>

        <!-- إرسال إشعار للموظفين -->
        <div class="card">
            <div class="card-header-title">إرسال إشعار للموظفين</div>
            <div class="card-header-sub">
                اختر الموظف الذي تريد تنبيهه، وسيتم تسجيل الإشعار له في النظام (محاكاة داخلية).
            </div>

            <div id="employeesList" class="employees-list">
                <!-- يتم تعبئتها من JS -->
            </div>
        </div>
    </section>

    <footer class="footer">
        © <span>Ghasiq</span> Logistical Support & Operations — جميع الحقوق محفوظة.
    </footer>
</div>

<script>
    // ===== Theme + User Chip =====
    const bodyEl = document.body;
    const themeToggle = document.getElementById("themeToggle");
    const themeLabel = document.getElementById("themeLabel");

    function applyTheme(mode) {
        if (mode === "light") {
            bodyEl.classList.add("light");
            themeLabel.textContent = "Light";
        } else {
            bodyEl.classList.remove("light");
            themeLabel.textContent = "Dark";
        }
        localStorage.setItem("ghasiq_theme", mode);
    }

    function initTheme() {
        const saved = localStorage.getItem("ghasiq_theme") || "dark";
        applyTheme(saved);
    }

    themeToggle.addEventListener("click", () => {
        const isLight = bodyEl.classList.contains("light");
        applyTheme(isLight ? "dark" : "light");
    });

    initTheme();

    (function showUser() {
        const chip = document.getElementById("userChip");
        const user = window.__gh_user;
        if (!user) return;
        chip.textContent = `${user.username} (${user.role})`;
    })();

    function logout() {
        localStorage.removeItem("ghasiq_user");
        window.location.href = "login.html";
    }

    // ===== MODEL: الموظفين =====
    // خليك مخلّي usernames هنا هي نفس usernames المستخدمين في صفحة اللوجين
    const EMPLOYEES = [
        {
            username: "it.head",
            displayName: "Eng/ Ahmed Gamal",
            title: "Head of IT Department",
            dept: "IT"
        },
        {
            username: "hr.head",
            displayName: "MR/ Mohamed Hamdy",
            title: "Head of HR Department",
            dept: "HR"
        },
        {
            username: "finance.head",
            displayName: "MR/ Emad Elden",
            title: "Head of Finance Department",
            dept: "Finance"
        },
        {
            username: "gm",
            displayName: "Eng/ Hamed ALAnazi",
            title: "General Manager",
            dept: "Management"
        },
        {
            username: "operations.pm",
            displayName: "MRS/ Randa Elarbory",
            title: "Project Manager",
            dept: "Operations"
        }
    ];

    const NOTIF_STORAGE_KEY = "ghasiq_notifications";

    function loadAllNotifications() {
        try {
            const raw = localStorage.getItem(NOTIF_STORAGE_KEY);
            if (!raw) return [];
            const arr = JSON.parse(raw);
            return Array.isArray(arr) ? arr : [];
        } catch {
            return [];
        }
    }

    function saveAllNotifications(list) {
        try {
            localStorage.setItem(NOTIF_STORAGE_KEY, JSON.stringify(list || []));
        } catch {
            // ignore
        }
    }

    function formatTime(date) {
        const d = new Date(date);
        if (isNaN(d.getTime())) return "";
        const dd = String(d.getDate()).padStart(2, "0");
        const mm = String(d.getMonth() + 1).padStart(2, "0");
        const yy = d.getFullYear();
        const hh = String(d.getHours()).padStart(2, "0");
        const mi = String(d.getMinutes()).padStart(2, "0");
        return `${dd}/${mm}/${yy} - ${hh}:${mi}`;
    }

    function renderMyNotifications() {
        const user = window.__gh_user;
        if (!user) return;

        const all = loadAllNotifications();
        const mine = all
            .filter(n => n.toUsername === user.username)
            .sort((a,b) => new Date(b.createdAt) - new Date(a.createdAt));

        const container = document.getElementById("notifList");
        container.innerHTML = "";

        if (mine.length === 0) {
            const empty = document.createElement("div");
            empty.className = "notif-empty";
            empty.textContent = "لا توجد إشعارات حتى الآن.";
            container.appendChild(empty);
            return;
        }

        mine.forEach(n => {
            const item = document.createElement("div");
            item.className = "notif-item";

            const msg = document.createElement("div");
            msg.textContent = n.message || "إشعار بدون رسالة.";

            const meta = document.createElement("div");
            meta.className = "notif-meta";
            meta.innerHTML = `<span>من: ${n.fromDisplayName}</span><span>${formatTime(n.createdAt)}</span>`;

            item.appendChild(msg);
            item.appendChild(meta);
            container.appendChild(item);
        });
    }

    function renderEmployeesList() {
        const user = window.__gh_user;
        if (!user) return;

        const listContainer = document.getElementById("employeesList");
        listContainer.innerHTML = "";

        // فلترة: شيل الموظف الحالي من الليستة
        const others = EMPLOYEES.filter(e => e.username !== user.username);

        if (others.length === 0) {
            const empty = document.createElement("div");
            empty.className = "notif-empty";
            empty.textContent = "لا يوجد موظفون آخرون لإرسال إشعار لهم.";
            listContainer.appendChild(empty);
            return;
        }

        others.forEach(emp => {
            const item = document.createElement("div");
            item.className = "employee-item";

            const main = document.createElement("div");
            main.className = "employee-main";

            const name = document.createElement("div");
            name.className = "employee-name";
            name.textContent = emp.displayName;

            const title = document.createElement("div");
            title.className = "employee-title";
            title.textContent = emp.title;

            const dept = document.createElement("div");
            dept.className = "employee-dept";
            dept.textContent = emp.dept;

            main.appendChild(name);
            main.appendChild(title);
            main.appendChild(dept);

            const btn = document.createElement("button");
            btn.className = "btn-send";
            btn.textContent = "إرسال إشعار";
            btn.addEventListener("click", () => sendNotificationTo(emp));

            item.appendChild(main);
            item.appendChild(btn);
            listContainer.appendChild(item);
        });
    }

    function sendNotificationTo(emp) {
        const message = prompt(`اكتب نص الإشعار للموظف: ${emp.displayName}`, "");
        if (!message || !message.trim()) return;

        const user = window.__gh_user;
        if (!user) return;

        const all = loadAllNotifications();
        all.push({
            id: "notif_" + Date.now() + "_" + Math.random().toString(16).slice(2),
            fromUsername: user.username,
            fromDisplayName: user.username + " (" + user.role + ")",
            toUsername: emp.username,
            toDisplayName: emp.displayName,
            message: message.trim(),
            createdAt: new Date().toISOString(),
            isRead: false
        });

        saveAllNotifications(all);

        // لو أنت بنفسك بعت إشعار لنفسك (مع إننا شايلينك من الليستة) – برضه هيتعرض
        renderMyNotifications();
        alert("تم تسجيل الإشعار للموظف بنجاح (محاكاة داخلية).");
    }

    document.getElementById("btnClearMyNotifs").addEventListener("click", () => {
        const user = window.__gh_user;
        if (!user) return;
        if (!confirm("هل أنت متأكد من مسح جميع إشعاراتك؟")) return;

        const all = loadAllNotifications();
        const remaining = all.filter(n => n.toUsername !== user.username);
        saveAllNotifications(remaining);
        renderMyNotifications();
    });

    // init
    renderEmployeesList();
    renderMyNotifications();
</script>

</body>
</html>
