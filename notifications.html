<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <title>Ghasiq â€“ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ©</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet" />

    <style>
        :root {
            --primary: #2563eb;
            --primary-light: #3b82f6;
            --primary-soft: rgba(37, 99, 235, 0.12);
            --accent: #22c55e;

            --bg-main: #020617;
            --bg-elevated: rgba(15, 23, 42, 0.94);
            --bg-card: rgba(15, 23, 42, 0.98);
            --border-subtle: rgba(148, 163, 184, 0.35);

            --text-main: #e5e7eb;
            --text-muted: #9ca3af;
            --shadow-strong: 0 20px 45px rgba(0, 0, 0, 0.8);
        }

        body.light {
            --bg-main: #f5f7fb;
            --bg-elevated: #ffffff;
            --bg-card: #ffffff;
            --border-subtle: rgba(148, 163, 184, 0.5);
            --text-main: #0f172a;
            --text-muted: #6b7280;
            --shadow-strong: 0 20px 45px rgba(15, 23, 42, 0.15);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: "Cairo", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            background:
                radial-gradient(circle at top left, rgba(37, 99, 235, 0.35), transparent 55%),
                radial-gradient(circle at bottom right, rgba(56, 189, 248, 0.28), transparent 55%),
                linear-gradient(135deg, #00020b, var(--bg-main) 45%, #00010a);
            color: var(--text-main);
            min-height: 100vh;
        }

        body.light {
            background:
                radial-gradient(circle at top left, rgba(191, 219, 254, 0.7), transparent 55%),
                radial-gradient(circle at bottom right, rgba(219, 234, 254, 0.7), transparent 55%),
                linear-gradient(135deg, #e5edff, #f9fafb 50%, #eff6ff);
        }

        a { text-decoration: none; color: inherit; }

        .page {
            max-width: 1140px;
            margin: 0 auto;
            padding: 20px 18px 40px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* NAVBAR */
        .navbar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 14px 18px;
            border-radius: 16px;
            background: var(--bg-elevated);
            box-shadow:
                0 16px 35px rgba(0, 0, 0, 0.75),
                0 0 0 1px rgba(148, 163, 184, 0.3);
            margin-bottom: 26px;
            backdrop-filter: blur(14px);
        }

        .navbar-left {
            display: flex;
            align-items: center;
            gap: 14px;
        }

        .logo {
            height: 46px;
            cursor: pointer;
        }

        .nav-links {
            display: flex;
            gap: 16px;
            font-size: 14px;
            color: var(--text-muted);
        }

        .nav-links a {
            position: relative;
            padding-bottom: 4px;
        }

        .nav-links a::after {
            content: "";
            position: absolute;
            right: 0;
            bottom: 0;
            width: 0;
            height: 2px;
            border-radius: 999px;
            background: linear-gradient(90deg, var(--primary-light), var(--primary));
            transition: width 0.18s ease;
        }

        .nav-links a:hover::after {
            width: 100%;
        }

        .nav-links a.active {
            color: var(--text-main);
            font-weight: 600;
        }
        .nav-links a.active::after {
            width: 100%;
        }

        .nav-actions {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .user-chip {
            font-size: 11px;
            padding: 4px 10px;
            border-radius: 999px;
            border: 1px solid rgba(148, 163, 184, 0.7);
            color: var(--text-muted);
        }

        .btn-toggle-theme,
        .btn-logout {
            border-radius: 999px;
            border: 1px solid var(--border-subtle);
            background: transparent;
            color: var(--text-main);
            padding: 6px 12px;
            font-size: 13px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .btn-logout {
            border-color: #ef4444;
            color: #fecaca;
        }

        /* LAYOUT */
        .notify-layout {
            display: grid;
            grid-template-columns: minmax(0, 1.2fr) minmax(0, 0.9fr);
            gap: 22px;
            flex: 1;
        }

        @media (max-width: 900px) {
            .notify-layout {
                grid-template-columns: 1fr;
            }
        }

        .card {
            border-radius: 20px;
            background: var(--bg-elevated);
            border: 1px solid var(--border-subtle);
            box-shadow: var(--shadow-strong);
            padding: 18px 18px 20px;
        }

        .card-title {
            font-size: 18px;
            margin-bottom: 4px;
        }

        .card-sub {
            font-size: 13px;
            color: var(--text-muted);
            margin-bottom: 14px;
        }

        /* EMPLOYEE LIST */
        .employee-list {
            display: grid;
            gap: 8px;
            margin-top: 10px;
        }

        .employee-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 10px;
            border-radius: 12px;
            background: rgba(15, 23, 42, 0.9);
        }

        body.light .employee-row {
            background: #f9fafb;
        }

        .employee-info {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .employee-name {
            font-size: 14px;
        }

        .employee-role {
            font-size: 11px;
            color: var(--text-muted);
        }

        .employee-dept {
            font-size: 11px;
            color: var(--primary-light);
        }

        .btn-notify {
            border-radius: 999px;
            border: none;
            cursor: pointer;
            font-size: 12px;
            padding: 7px 14px;
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            box-shadow: 0 10px 20px rgba(37, 99, 235, 0.6);
        }

        /* ACTIVITY / HISTORY */
        .history-list {
            display: grid;
            gap: 8px;
            max-height: 340px;
            overflow-y: auto;
            padding-right: 4px;
        }

        .history-item {
            font-size: 12px;
            padding: 8px 10px;
            border-radius: 10px;
            background: rgba(15, 23, 42, 0.95);
            border: 1px solid rgba(148, 163, 184, 0.4);
            color: var(--text-muted);
        }

        body.light .history-item {
            background: #f9fafb;
        }

        .history-item strong {
            color: var(--text-main);
            font-weight: 600;
        }

        .history-meta {
            font-size: 11px;
            margin-top: 2px;
            color: var(--primary-light);
        }

        .empty-state {
            font-size: 12px;
            color: var(--text-muted);
            margin-top: 8px;
        }

        /* TOAST */
        .toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 10px 16px;
            border-radius: 999px;
            font-size: 13px;
            background: rgba(22, 163, 74, 0.96);
            color: #ecfdf5;
            box-shadow: 0 18px 35px rgba(0, 0, 0, 0.55);
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s ease, transform 0.2s ease;
            z-index: 50;
        }

        .toast.show {
            opacity: 1;
            transform: translateX(-50%) translateY(-4px);
        }

        .footer {
            margin-top: 22px;
            text-align: center;
            font-size: 12px;
            color: var(--text-muted);
        }
        .footer span { color: var(--primary-light); }

        /* ========== NEW STYLES FOR ATTACHMENT UI ========== */
        .attach-toggle {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 12px;
            font-size: 12px;
            color: var(--text-muted);
        }

        .attach-toggle-label {
            font-size: 12px;
        }

        .radio-pills {
            display: inline-flex;
            gap: 6px;
        }

        .radio-pill {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 10px;
            border-radius: 999px;
            border: 1px solid var(--border-subtle);
            cursor: pointer;
            font-size: 11px;
            color: var(--text-main);
            background: rgba(15, 23, 42, 0.9);
        }

        body.light .radio-pill {
            background: #f9fafb;
        }

        .radio-pill input {
            accent-color: var(--primary);
            cursor: pointer;
        }

        .radio-pill.active {
            border-color: var(--primary-light);
            box-shadow: 0 0 0 1px rgba(37, 99, 235, 0.4);
        }

        .file-upload-wrapper {
            margin-top: 10px;
            margin-bottom: 12px;
            font-size: 12px;
        }

        .file-upload-label {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 999px;
            border: 1px solid var(--border-subtle);
            background: var(--bg-card);
            color: var(--text-main);
            cursor: pointer;
            font-size: 12px;
            box-shadow: 0 6px 14px rgba(15, 23, 42, 0.7);
        }

        body.light .file-upload-label {
            background: #ffffff;
        }

        .file-upload-label span.icon {
            font-size: 14px;
        }

        .file-upload-input {
            display: none;
        }

        .selected-file-name {
            display: block;
            margin-top: 6px;
            font-size: 11px;
            color: var(--text-muted);
        }
    </style>
</head>
<body class="dark">

<!-- Auth Guard Ø¬Ø¯ÙŠØ¯ ÙŠØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ ghasiq_current_user -->
<script>
    (function guard() {
        const user = JSON.parse(localStorage.getItem("ghasiq_current_user") || "null");
        if (!user) {
            window.location.href = "login.html";
            return;
        }
        window.__gh_user = user;
    })();
</script>

<div class="page">

    <!-- NAVBAR -->
    <header class="navbar">
        <div class="navbar-left">
            <a href="index.html">
                <img src="logo.png" alt="GHASIQ Logo" class="logo" />
            </a>
            <nav class="nav-links">
                <a href="index.html#about" data-i18n="nav_about">Ø¹Ù† Ghasiq</a>
                <a href="services.html" data-i18n="nav_services">Ø§Ù„Ø®Ø¯Ù…Ø§Øª</a>
                <a href="call-system.html" data-i18n="nav_call_system">Ù†Ø¸Ø§Ù… Ø§Ù„Ø§ØªØµØ§Ù„</a>
                <a href="notifications.html" class="active" data-i18n="nav_notifications">Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</a>
            </nav>
        </div>

        <div class="nav-actions">
            <span class="user-chip" id="userChip">---</span>

            <!-- Ø²Ø± Ø§Ù„Ù„ØºØ© -->
            <button class="btn-toggle-theme" id="langToggle" type="button">
                <span id="langLabel">AR</span>
            </button>

            <!-- Ø§Ù„Ø«ÙŠÙ… -->
            <button class="btn-toggle-theme" id="themeToggle" type="button">
                <span id="themeLabel">Dark</span>
                <span id="themeIcon">â˜¾</span>
            </button>

            <button class="btn-logout" type="button" onclick="logout()" data-i18n="btn_logout">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
        </div>
    </header>

    <!-- MAIN CONTENT -->
    <section class="notify-layout">
        <!-- LEFT: EMPLOYEES -->
        <article class="card">
            <h2 class="card-title" data-i18n="notify_title_left">Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ù„Ù„Ù…ÙˆØ¸ÙÙŠÙ†</h2>
            <p class="card-sub" data-i18n="notify_sub_left">
                Ø§Ø®ØªØ± Ø§Ù„Ù…ÙˆØ¸Ù Ø§Ù„Ø°ÙŠ ØªØ±ÙŠØ¯ ØªÙ†Ø¨ÙŠÙ‡Ù‡ØŒ ÙˆØ³ÙŠØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ù‡Ù†Ø§ ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù… (Ù…Ø­Ø§ÙƒØ§Ø© Ø¯Ø§Ø®Ù„ÙŠØ© â€“ Ø¨Ø¯ÙˆÙ† Ø¥Ø±Ø³Ø§Ù„ Ø®Ø§Ø±Ø¬ÙŠ Ø­Ù‚ÙŠÙ‚ÙŠ).
            </p>

            <div class="employee-list" id="employeeList">
                <!-- ÙŠØªÙ… Ù…Ù„Ø¤Ù‡ Ù…Ù† Ø§Ù„Ù€ JS -->
            </div>
        </article>

        <!-- RIGHT: HISTORY -->
        <aside class="card">
            <h2 class="card-title" data-i18n="notify_title_right">Ø³Ø¬Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</h2>
            <p class="card-sub" data-i18n="notify_sub_right">
                Ø¢Ø®Ø± Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„ØªÙŠ ØªÙ… Ø¥Ø±Ø³Ø§Ù„Ù‡Ø§ Ù…Ù† Ø®Ù„Ø§Ù„ Ø§Ù„Ù†Ø¸Ø§Ù…ØŒ Ù…Ø±ØªÙ‘Ø¨Ø© Ø¨Ø§Ù„Ø£Ø­Ø¯Ø« Ø£ÙˆÙ„Ø§Ù‹.
            </p>
            <button type="button"
                    class="btn-toggle-theme"
                    style="margin-bottom:12px; padding:6px 14px; font-size:12px;"
                    onclick="clearNotifications()"
                    data-i18n="btn_clear_notifications">
                Ù…Ø³Ø­ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
            </button>

            <div id="historyList" class="history-list"></div>
            <div id="emptyHistory" class="empty-state" data-i18n="empty_history">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†.</div>
        </aside>
    </section>

    <!-- Ø¥Ø´Ø¹Ø§Ø± Ù…Ø®ØµØµ + Ù…Ù„Ù Ù…Ø±ÙÙ‚ -->
    <div id="notifyOverlay"
         style="
            display:none;
            position:fixed;
            inset:0;
            background:rgba(15,23,42,0.75);
            backdrop-filter:blur(4px);
            z-index:80;
            align-items:center;
            justify-content:center;
         ">
        <div class="card" style="max-width:420px; width:100%;">
            <h3 class="card-title" data-i18n="dialog_title">Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø±</h3>
            <p class="card-sub" data-i18n="dialog_sub">
                Ø§ÙƒØªØ¨ Ù†Øµ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±ØŒ ÙˆÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø®ØªÙŠØ§Ø± Ø¥Ø±ÙØ§Ù‚ Ù…Ù„Ù Ø¥Ø°Ø§ Ø§Ø­ØªØ¬Øª Ø°Ù„Ùƒ.
            </p>

            <div style="font-size:13px; margin-bottom:8px;">
                <span data-i18n="label_to">Ø¥Ù„Ù‰:</span>
                <span id="notifyEmployeeName" style="color:var(--primary-light);"></span>
            </div>

            <textarea id="notifyMessage"
                      data-i18n-placeholder="notify_placeholder"
                      style="
                          width:100%;
                          min-height:90px;
                          border-radius:10px;
                          border:1px solid var(--border-subtle);
                          background:var(--bg-card);
                          color:var(--text-main);
                          font-family:inherit;
                          font-size:13px;
                          padding:8px 10px;
                          resize:vertical;
                      "
                      placeholder="Ø§ÙƒØªØ¨ Ù†Øµ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ù‡Ù†Ø§..."></textarea>

            <!-- Ø³Ø¤Ø§Ù„: Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ø±ÙØ§Ù‚ Ù…Ù„ÙØŸ -->
            <div class="attach-toggle">
                <span class="attach-toggle-label" data-i18n="attach_question">Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ø±ÙØ§Ù‚ Ù…Ù„ÙØŸ</span>
                <div class="radio-pills">
                    <label class="radio-pill active">
                        <input type="radio" name="attachOption" value="no" checked />
                        <span data-i18n="attach_no">Ù„Ø§</span>
                    </label>
                    <label class="radio-pill">
                        <input type="radio" name="attachOption" value="yes" />
                        <span data-i18n="attach_yes">Ù†Ø¹Ù…</span>
                    </label>
                </div>
            </div>

            <!-- Ø¨Ù„ÙˆÙƒ Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù (ÙŠØ¸Ù‡Ø± ÙÙ‚Ø· Ù„Ùˆ Ø§Ø®ØªØ§Ø± Ù†Ø¹Ù…) -->
            <div id="fileUploadWrapper" class="file-upload-wrapper" style="display:none;">
                <label for="notifyFile" data-i18n="attach_label">Ø¥Ø¶Ø§ÙØ© Ù…Ù„Ù Ù…Ø±ÙÙ‚:</label><br />
                <label for="notifyFile" class="file-upload-label">
                    <span class="icon">ğŸ“</span>
                    <span data-i18n="attach_button">Ø§Ø®ØªØ± Ø§Ù„Ù…Ù„Ù</span>
                    <span style="font-size:10px; color:var(--text-muted);" data-i18n="attach_optional">(Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</span>
                </label>
                <input id="notifyFile" type="file" class="file-upload-input" />
                <span id="selectedFileName" class="selected-file-name" data-i18n="attach_no_file">Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù</span>
            </div>

            <div style="display:flex; justify-content:flex-end; gap:8px;">
                <button type="button"
                        onclick="closeNotifyDialog()"
                        class="btn-toggle-theme"
                        style="padding-inline:14px;"
                        data-i18n="btn_cancel">
                    Ø¥Ù„ØºØ§Ø¡
                </button>
                <button type="button"
                        onclick="confirmNotification()"
                        class="btn-notify"
                        style="padding-inline:18px;"
                        data-i18n="btn_send_notify">
                    ğŸš€ Ø¥Ø±Ø³Ø§Ù„
                </button>
            </div>
        </div>
    </div>

    <footer class="footer" data-i18n="footer_text">
        Â© <span>Ghasiq</span> Logistical Support & Operations â€” Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©.
    </footer>
</div>

<div id="toast" class="toast"></div>

<!-- auth.js Ø§Ù„Ù…Ø´ØªØ±Ùƒ -->
<script src="auth.js"></script>

<script>
    // ===== Theme =====
    const bodyEl = document.body;
    const themeToggle = document.getElementById("themeToggle");
    const themeLabel = document.getElementById("themeLabel");
    const themeIcon = document.getElementById("themeIcon");

    function applyTheme(mode) {
        if (mode === "light") {
            bodyEl.classList.add("light");
            bodyEl.classList.remove("dark");
            themeLabel.textContent = "Light";
            themeIcon.textContent = "â˜€";
        } else {
            bodyEl.classList.add("dark");
            bodyEl.classList.remove("light");
            themeLabel.textContent = "Dark";
            themeIcon.textContent = "â˜¾";
        }
        localStorage.setItem("ghasiq_theme", mode);
    }

    function initTheme() {
        const saved = localStorage.getItem("ghasiq_theme");
        applyTheme(saved === "light" ? "light" : "dark");
    }

    themeToggle.addEventListener("click", () => {
        const isLight = bodyEl.classList.contains("light");
        applyTheme(isLight ? "dark" : "light");
    });

    initTheme();

    // ===== Auth + User Chip =====
    function logout() {
        if (window.Auth && typeof Auth.logout === "function") {
            Auth.logout();
        } else {
            // fallback Ù„Ùˆ auth.js Ù„Ø³Ù‡ Ù…Ø§ Ø§ØªØ¸Ø¨Ø·Ø´
            localStorage.removeItem("ghasiq_current_user");
        }
        window.location.href = "login.html";
    }

    (function initUser() {
        const user = window.__gh_user || null;
        const chip = document.getElementById("userChip");

        if (!user) {
            window.location.href = "login.html";
            return;
        }

        chip.textContent = user.username + " â€” " + user.role;
    })();

    // ===== Employees Data =====
    const employees = [
        { id: 1, name: "Eng/ Ahmed Gamal", role: "Head of IT Department", dept: "IT" },
        { id: 2, name: "MR/ Mohamed Hamdy", role: "Head of HR Department", dept: "HR" },
        { id: 3, name: "MR/ Emad Elden", role: "Head of Finance Department", dept: "Finance" },
        { id: 4, name: "Eng/ Hamed ALAnazi", role: "General Manager", dept: "Management" },
        { id: 5, name: "MRS/ Randa Elbarbory", role: "Project Manager", dept: "Operations" }
    ];

    const employeeListEl = document.getElementById("employeeList");
    const historyListEl  = document.getElementById("historyList");
    const emptyHistoryEl = document.getElementById("emptyHistory");
    const toastEl        = document.getElementById("toast");

    let selectedEmployeeId = null;

    // Ø¹Ù†Ø§ØµØ± Ø®Ø§ØµØ© Ø¨Ø§Ø®ØªÙŠØ§Ø± Ø¥Ø±ÙØ§Ù‚ Ø§Ù„Ù…Ù„Ù
    let attachOptionsRadios = null;
    let fileUploadWrapper   = null;
    let selectedFileNameEl  = null;

    // ===== ØªØ±Ø¬Ù…Ø§Øª Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ© =====
    const notifyTexts = {
        ar: {
            toast_write_message_first: "Ù…Ù† ÙØ¶Ù„Ùƒ Ø§ÙƒØªØ¨ Ù†Øµ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ø£ÙˆÙ„Ø§Ù‹",
            toast_sent_to: "ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ø¥Ù„Ù‰",
            toast_cleared: "ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª",
            no_file_selected: "Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù",
            history_default_message: "Ø£Ø­ØªØ§Ø¬Ùƒ ÙÙŠ Ù…ÙƒØªØ¨ÙŠ Ø§Ù„Ø¢Ù† Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©.",
            history_label_to: "Ø¥Ø´Ø¹Ø§Ø± Ø¥Ù„Ù‰",
            history_label_content: "Ø§Ù„Ù…Ø­ØªÙˆÙ‰:",
            history_label_attachment: "Ù…Ø±ÙÙ‚:",
            history_label_sender: "Ù…Ø±Ø³Ù„ Ø¨ÙˆØ§Ø³Ø·Ø©:"
        },
        en: {
            toast_write_message_first: "Please write the notification text first",
            toast_sent_to: "Notification sent to",
            toast_cleared: "Notifications cleared",
            no_file_selected: "No file selected",
            history_default_message: "I need you in my office now for follow-up.",
            history_label_to: "Notification to",
            history_label_content: "Content:",
            history_label_attachment: "Attachment:",
            history_label_sender: "Sent by:"
        }
    };

    function getCurrentLang() {
        return localStorage.getItem("ghasiq_lang") || "ar";
    }

    function trMsg(key) {
        const lang = getCurrentLang();
        const dict = notifyTexts[lang] || {};
        return dict[key] || key;
    }

    function openNotifyDialog(empId) {
        const emp = employees.find(e => e.id === empId);
        if (!emp) return;

        selectedEmployeeId = empId;

        const overlay   = document.getElementById("notifyOverlay");
        const nameEl    = document.getElementById("notifyEmployeeName");
        const msgEl     = document.getElementById("notifyMessage");
        const fileInput = document.getElementById("notifyFile");

        fileUploadWrapper  = document.getElementById("fileUploadWrapper");
        selectedFileNameEl = document.getElementById("selectedFileName");
        attachOptionsRadios = document.querySelectorAll("input[name='attachOption']");

        if (nameEl) nameEl.textContent = emp.name;
        if (msgEl) {
            msgEl.value = "";
            setTimeout(() => msgEl.focus(), 0);
        }
        if (fileInput) {
            fileInput.value = "";
        }
        if (selectedFileNameEl) {
            selectedFileNameEl.textContent = trMsg("no_file_selected");
        }

        // Ø±Ø¬Ù‘Ø¹ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± Ø¥Ù„Ù‰ "Ù„Ø§"
        if (attachOptionsRadios) {
            attachOptionsRadios.forEach(r => {
                r.checked = r.value === "no";
                r.parentElement.classList.toggle("active", r.value === "no");
            });
        }
        if (fileUploadWrapper) {
            fileUploadWrapper.style.display = "none";
        }

        overlay.style.display = "flex";
    }

    function closeNotifyDialog() {
        const overlay = document.getElementById("notifyOverlay");
        overlay.style.display = "none";
    }

    function confirmNotification() {
        if (selectedEmployeeId == null) return;

        const msgEl     = document.getElementById("notifyMessage");
        const fileInput = document.getElementById("notifyFile");

        const message = (msgEl?.value || "").trim();

        if (!message) {
            showToast(trMsg("toast_write_message_first"));
            return;
        }

        let fileName = "";
        if (fileInput && fileInput.files && fileInput.files.length > 0) {
            fileName = fileInput.files[0].name;
        }

        sendNotification(selectedEmployeeId, message, fileName);
        closeNotifyDialog();
    }

    function renderEmployees() {
        employeeListEl.innerHTML = "";
        employees.forEach(emp => {
            const row = document.createElement("div");
            row.className = "employee-row";

            row.innerHTML = `
                <div class="employee-info">
                    <div class="employee-name">${emp.name}</div>
                    <div class="employee-role">${emp.role}</div>
                    <div class="employee-dept">${emp.dept}</div>
                </div>
                <button class="btn-notify" type="button" onclick="openNotifyDialog(${emp.id})" data-i18n="btn_notify">
                    Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø±
                </button>
            `;

            employeeListEl.appendChild(row);
        });
    }

    function showToast(message) {
        toastEl.textContent = message;
        toastEl.classList.add("show");
        setTimeout(() => toastEl.classList.remove("show"), 2000);
    }

    function addHistoryItem(emp, senderName, message, fileName) {
        const lang = getCurrentLang();
        const locale = lang === "en" ? "en-US" : "ar-SA";

        const now = new Date();
        const timeStr = now.toLocaleTimeString(locale, { hour: "2-digit", minute: "2-digit" });

        const item = document.createElement("div");
        item.className = "history-item";

        const safeMessage = message && message.trim()
            ? message.trim()
            : trMsg("history_default_message");

        item.innerHTML = `
            <strong>${trMsg("history_label_to")} ${emp.name}</strong>
            <div>${trMsg("history_label_content")} ${safeMessage}</div>
            ${fileName ? `<div>${trMsg("history_label_attachment")} ${fileName}</div>` : ""}
            <div class="history-meta">${trMsg("history_label_sender")} ${senderName || "System"} â€” ${timeStr}</div>
        `;

        historyListEl.prepend(item);
        emptyHistoryEl.style.display = "none";
    }

    function sendNotification(empId, message, fileName) {
        const emp = employees.find(e => e.id === empId);
        if (!emp) return;

        const user = window.__gh_user || null;
        const senderName = user?.username || "Ghasiq System";

        addHistoryItem(emp, senderName, message, fileName);
        showToast(trMsg("toast_sent_to") + " " + emp.name);
    }

    function clearNotifications() {
        historyListEl.innerHTML = "";
        emptyHistoryEl.style.display = "block";
        showToast(trMsg("toast_cleared"));
    }

    // ===== Attachment UI Events =====
    document.addEventListener("DOMContentLoaded", () => {
        attachOptionsRadios = document.querySelectorAll("input[name='attachOption']");
        fileUploadWrapper   = document.getElementById("fileUploadWrapper");
        selectedFileNameEl  = document.getElementById("selectedFileName");
        const fileInput     = document.getElementById("notifyFile");

        if (attachOptionsRadios) {
            attachOptionsRadios.forEach(radio => {
                radio.addEventListener("change", (e) => {
                    const value = e.target.value;

                    attachOptionsRadios.forEach(r => {
                        r.parentElement.classList.toggle("active", r === e.target);
                    });

                    if (value === "yes") {
                        if (fileUploadWrapper) fileUploadWrapper.style.display = "block";
                    } else {
                        if (fileUploadWrapper) fileUploadWrapper.style.display = "none";
                        if (fileInput) fileInput.value = "";
                        if (selectedFileNameEl) selectedFileNameEl.textContent = trMsg("no_file_selected");
                    }
                });
            });
        }

        if (fileInput) {
            fileInput.addEventListener("change", () => {
                if (fileInput.files && fileInput.files.length > 0) {
                    const name = fileInput.files[0].name;
                    if (selectedFileNameEl) selectedFileNameEl.textContent = name;
                } else {
                    if (selectedFileNameEl) selectedFileNameEl.textContent = trMsg("no_file_selected");
                }
            });
        }
    });

    // init
    renderEmployees();
</script>

<script>
    // ========== ØªØ±Ø¬Ù…Ø§Øª Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø«Ø§Ø¨ØªØ© ==========
    const translations = {
        ar: {}, // Ù‡ØªÙ…Ù„Ø§ Ø£ÙˆØªÙˆÙ…Ø§ØªÙŠÙƒ Ù…Ù† Ø§Ù„Ù€ DOM
        en: {
            page_title: "Ghasiq â€“ Internal Notifications",
            nav_about: "About Ghasiq",
            nav_services: "Services",
            nav_call_system: "Call System",
            nav_notifications: "Notifications",
            btn_logout: "Log out",

            notify_title_left: "Send notifications to employees",
            notify_sub_left: "Choose the employee you want to notify. The notification will be logged here in the system (internal simulation â€“ no external sending).",

            notify_title_right: "Notifications history",
            notify_sub_right: "Latest notifications sent through the system, ordered by newest first.",
            btn_clear_notifications: "Clear notifications",
            empty_history: "No notifications yet.",

            dialog_title: "Send notification",
            dialog_sub: "Write the notification text, and you can attach a file if needed.",
            label_to: "To:",

            notify_placeholder: "Write the notification text here...",

            attach_question: "Do you want to attach a file?",
            attach_no: "No",
            attach_yes: "Yes",
            attach_label: "Add attachment:",
            attach_button: "Choose file",
            attach_optional: "(Optional)",
            attach_no_file: "No file selected",

            btn_cancel: "Cancel",
            btn_send_notify: "ğŸš€ Send",
            btn_notify: "Send notification",

            footer_text: "Â© <span>Ghasiq</span> Logistical Support & Operations â€” All rights reserved."
        }
    };

    function initArabicFromDom() {
        document.querySelectorAll("[data-i18n]").forEach(el => {
            const key = el.getAttribute("data-i18n");
            if (!translations.ar[key]) {
                translations.ar[key] = el.innerHTML;
            }
        });

        document.querySelectorAll("[data-i18n-placeholder]").forEach(el => {
            const key = el.getAttribute("data-i18n-placeholder");
            if (!translations.ar[key]) {
                translations.ar[key] = el.placeholder || "";
            }
        });

        // Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØµÙØ­Ø©
        translations.ar.page_title = document.title;
    }

    function applyTranslations(lang) {
        document.querySelectorAll("[data-i18n]").forEach(el => {
            const key = el.getAttribute("data-i18n");
            const value = translations[lang] && translations[lang][key];
            if (!value) return;
            el.innerHTML = value;
        });

        document.querySelectorAll("[data-i18n-placeholder]").forEach(el => {
            const key = el.getAttribute("data-i18n-placeholder");
            const value = translations[lang] && translations[lang][key];
            if (!value) return;
            el.placeholder = value;
        });

        if (translations[lang].page_title) {
            document.title = translations[lang].page_title;
        }
    }

    // ==================== Language Toggle ====================
    function applyLanguage(lang) {
        localStorage.setItem("ghasiq_lang", lang);

        if (lang === "en") {
            document.documentElement.setAttribute("dir", "ltr");
            document.documentElement.lang = "en";
            document.getElementById("langLabel").textContent = "EN";
        } else {
            document.documentElement.setAttribute("dir", "rtl");
            document.documentElement.lang = "ar";
            document.getElementById("langLabel").textContent = "AR";
        }

        applyTranslations(lang);
    }

    function initLanguageToggle() {
        initArabicFromDom();

        const saved = localStorage.getItem("ghasiq_lang") || "ar";
        applyLanguage(saved);

        const langToggle = document.getElementById("langToggle");
        if (!langToggle) return;

        langToggle.addEventListener("click", () => {
            const current = localStorage.getItem("ghasiq_lang") || "ar";
            const nextLang = current === "ar" ? "en" : "ar";
            applyLanguage(nextLang);
        });
    }

    initLanguageToggle();
</script>

</body>
</html>
